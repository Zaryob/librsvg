--- rsvg.c	2005-01-17 02:01:34.000000000 +0100
+++ rsvg.c.new	2005-06-30 21:58:16.767664552 +0200
@@ -1431,20 +1431,20 @@
 gchar *
 rsvg_get_base_uri_from_filename(const gchar * file_name)
 {
+	gchar *curdir;
+	gchar *reldir;
 	gchar *base_uri;
-	int i, last;
 
-	last = 0;
-	for (i = 0; file_name[i] != '\0'; i++)
-		if (file_name[i] == G_DIR_SEPARATOR)
-			last = i;
+	reldir = g_path_get_dirname (file_name);
 
-	base_uri = g_new(gchar, i + 2);
-  
-	for (i = 0; i <= last; i++)
-		base_uri[i] = file_name[i];
+	if (g_path_is_absolute (file_name))
+		return reldir;
+	
+	curdir = g_get_current_dir();
+	base_uri = g_build_filename (curdir, reldir, NULL);
+	g_free (curdir);
+	g_free (reldir);
 
-	base_uri[i] = '\0';
 	return base_uri;
 }
 
